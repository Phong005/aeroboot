
#=========================================================================#
# Make file for Avlgo, 
#    -----------------------------------------
#    generated by Gandalf <ganstein@gmail.com>
#    2006-01-06
# 
# AviatoR is attend to deploy a Graphic Multiboot Loader hosted on CDROM
#=========================================================================#

# NOTE!
#    This project must be compiled by Djgpp
export

include make.pwd

TOPDIR = $(src_dir)

INCLUDE = -I$(src_dir)/stage1 -I$(src_dir)/stage2

#=================================================================
#                                      define a compiling version
#=================================================================
MAJORVER = 0
MINORVER = 06
VER_     = 2

AVIATOR_VERNUM  = $(VER_)$(MAJORVER)$(MINORVER)
AVIATOR_VERSION = $(MAJORVER).$(MINORVER)
DEFVERSION      = -DAVIATOR_VERNUM=$(AVIATOR_VERNUM) -DAVIATOR_VERSION=\"$(AVIATOR_VERSION)\"
VERFIX          = .$(AVIATOR_VERSION)
RELEASEPATH     = $(src_dir)/../bin

#=================================================================
#                                               compiler settings
#=================================================================
CC      = gcc
CL      = gcc
NS      = nasmw
AS      = as
LD      = ld
RM      = rm -f
CP      = cp
PWD     = pwd
ECHO    = echo
CAT		= cat

PREFIX  = @

# ============================================= GCC settings
INC     = $(INCLUDE)
OPT     = -O2 -fregmove -foptimize-register-move -finline-functions
CFLAGS  = $(DEFVERSION) -Wall -nostdinc -nostdlib -MD $(INC) $(OPT)
ASFLAGS  = -nostdinc -nostdlib $(INC) 

# ============================================= LD settings
LDFLAGS = -nostdlib -N -Ttext=0x8200 -e _start

# ============================================= Nasm settings
NSELFFLAGS  = -f aout -s -o
NSBINFLAGS  = -f bin -s -o

# ============================================= Key maps
KEYMAP       = keymap
KEYMAPFLAGS  = -DKEYMAP_EXE

# ============================================= Obj Settings
OBJDUMP  = objdump
OBJCOPY  = objcopy

# ============================================= Backup Project
TAR      = tar
TFLAGS   = -zcf


#=================================================================
#                                           default make settings
#=================================================================
all: iso_image
	

iso_image:  stage_1 stage_2
	$(PREFIX)$(ECHO) _
#	$(PREFIX)$(ECHO) Creating Test ISO ...
#	$(CDIMG) $(AERO_ISO)
#	$(PREFIX)$(ECHO) .................................................................... [ Done! ]
	

stage_1:
	$(PREFIX)$(ECHO) ____________________________________________________________________ [ stage1 ]
	$(MAKE) -C  $(src_dir)/stage1

stage_2:
	$(PREFIX)$(ECHO) ____________________________________________________________________ [ stage2 ]
	$(MAKE) -C  $(src_dir)/stage2


clean:
	$(MAKE) -C  $(src_dir)/stage1 clean
	$(MAKE) -C  $(src_dir)/stage2 clean

