#=========================================================================#
# Make file for AviaotR's Starup, 
#    -----------------------------------------
#    generated by Gandalf <ganstein@gmail.com>
#    2006-01-06
# 
# AviatoR is attend to deploy a Graphic Multiboot Loader hosted on CDROM
#=========================================================================#

stage1: stage1_exec
	$(ECHO) Making $@ 
	

# compile ruls
  
%.o: %.S
	$(CC) $(ASFLAGS) -c -o $@ $<


STAGE1_OBJS = stage1.o

stage1.ld: $(STAGE1_OBJS)
	$(PREFIX)$(LD) -nostdlib -N -Ttext 7C00 $(STAGE1_OBJS) -o $@	
	
stage1_exec: stage1.ld
	$(PREFIX)$(ECHO) $(OBJDUMP): 反汇编 $< 到 $(basename $@).map
	$(PREFIX)$(OBJDUMP) -d -S $< > $(basename $@).map
	$(PREFIX)$(ECHO) $(OBJCOPY): 输出 $< 到二进制 $@
	$(PREFIX)$(OBJCOPY) -R .note -R .comment -S -O binary $< $@
	$(PREFIX)dd if=$@ of=stage1.bin bs=512 count=1


clean:
	$(PREFIX)$(ECHO) ____________________________________________________________________ [ clean stage1 ]
	$(RM) *.o
	$(RM) *.d

	